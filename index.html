<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Chat App</title>

<style>
/* ===== Dark Theme & Layout ===== */
:root {
  --bg: #121212;
  --sidebar-bg: #1f1f1f;
  --chat-bg: #181818;
  --text: #e0e0e0;
  --muted: #888;
  --mine-bg: #4caf50;
  --their-bg: #2c2c2c;
  --accent: #2196f3;
  --border-radius: 12px;
  --font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}

body { margin:0; font-family: var(--font-family); background: var(--bg); color: var(--text); }
h2,h3{ margin:0; }

.login-container {
  width: 320px; margin: 80px auto; display:flex; flex-direction:column; gap:12px;
  background: var(--sidebar-bg); padding:20px; border-radius: var(--border-radius);
  box-shadow:0 0 20px rgba(0,0,0,0.5);
}
.login-container input { padding:10px; border-radius:8px; border:none; outline:none; background:#2c2c2c; color: var(--text); }
.login-container button { padding:10px; border-radius:8px; border:none; background: var(--accent); color:#fff; cursor:pointer; font-weight:bold; transition: background 0.2s; }
.login-container button:hover { background:#1976d2; }
#status { color: var(--muted); font-size:0.85rem; min-height:18px; }

.chat-container { display:flex; height:100vh; }
.sidebar { width:250px; background:var(--sidebar-bg); padding:10px; overflow-y:auto; box-shadow:2px 0 5px rgba(0,0,0,0.5); } /* reduced */
.sidebar ul { list-style:none; padding:0; margin:10px 0 0 0; }
.sidebar li { padding:8px; border-radius:var(--border-radius); margin-bottom:6px; cursor:pointer; transition:background 0.2s; } /* reduced */
.sidebar li:hover { background:#333; }
.sidebar li.active { background:var(--accent); color:#fff; }

.add-chat-btn { width:100%; padding:8px; border:none; border-radius:8px; background: var(--accent); color:#fff; font-weight:bold; cursor:pointer; margin-bottom:12px; } /* reduced */
.add-chat-btn:hover { background:#1976d2; }

.chat-main { flex:1; display:flex; flex-direction:column; background: var(--chat-bg); }
.messages { flex:1; padding:12px; overflow-y:auto; display:flex; flex-direction:column; gap:6px; } /* reduced */
.message { padding:8px 12px; max-width:65%; border-radius:var(--border-radius); word-wrap:break-word; position:relative; } /* reduced */
.message.mine { background:var(--mine-bg); color:#fff; align-self:flex-end; border-bottom-right-radius:2px; }
.message.their { background:var(--their-bg); color:#fff; align-self:flex-start; border-bottom-left-radius:2px; }
.message .meta { font-size:0.75rem; color:var(--muted); margin-bottom:4px; }

.input-container { display:flex; padding:6px 12px; background: var(--sidebar-bg); border-top:1px solid #333; } /* reduced */
#messageInput { flex:1; padding:7px; border-radius:8px; border:none; background:#2c2c2c; color: var(--text); outline:none; font-size:1rem; } /* reduced */
#sendBtn { margin-left:10px; padding:8px 14px; border-radius:8px; border:none; background: var(--accent); color:#fff; font-weight:bold; cursor:pointer; transition:background 0.2s; } /* reduced */
#sendBtn:hover { background:#1976d2; }

.modal { position:fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.6); display:none; align-items:center; justify-content:center; }
.modal-content { background: var(--sidebar-bg); padding:20px; border-radius:var(--border-radius); width:300px; max-height:70%; overflow-y:auto; display:flex; flex-direction:column; }
.modal input { padding:8px; margin-bottom:12px; border-radius:8px; border:none; background:#2c2c2c; color: var(--text); outline:none; }

.user-item { padding:6px 8px; cursor:pointer; border-radius:8px; margin-bottom:4px; }
.user-item:hover { background:#333; }
.user-item.selected { background: var(--accent); color:#fff; }

@media(max-width:768px) {
  .chat-container{ flex-direction:column; }
  .sidebar{ width:100%; height:auto; box-shadow:none; }
  .messages{ padding:10px; }
}</style>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

<script>
  // your firebase config
  const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_AUTH_DOMAIN",
    projectId: "YOUR_PROJECT_ID",
    storageBucket: "YOUR_STORAGE_BUCKET",
    messagingSenderId: "YOUR_SENDER_ID",
    appId: "YOUR_APP_ID"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();
</script>

</head>
<body>

<div id="topBar">Chat</div>

<div id="chatArea"></div>

<div id="inputBar">
  <input id="messageInput" placeholder="Message…" />
  <button id="sendBtn">Send</button>
</div>


<script>
let currentUser = null;
let currentChatId = "global";

// Sign in anonymously
firebase.auth().signInAnonymously().then(u => {
  currentUser = u.user;
});

// Format timestamp with date + time
function formatTime(d){
  const year = d.getFullYear();
  const month = (d.getMonth() + 1).toString().padStart(2, '0');
  const day = d.getDate().toString().padStart(2, '0');
  const h = d.getHours().toString().padStart(2,'0');
  const m = d.getMinutes().toString().padStart(2,'0');
  const s = d.getSeconds().toString().padStart(2,'0');
  return `${year}-${month}-${day} ${h}:${m}:${s}`;
}

// Add message to DOM
function addMessageToDOM(msgData) {
  const msgDiv = document.createElement("div");
  msgDiv.className = "msg";

  msgDiv.innerHTML = `
    <div>${msgData.text}</div>
    <div class="meta">
      ${msgData.username || "anon"} –
      ${formatTime(msgData.time?.toDate?.() || new Date())}
    </div>
  `;

  document.getElementById("chatArea").appendChild(msgDiv);
  document.getElementById("chatArea").scrollTop =
    document.getElementById("chatArea").scrollHeight;
}

// Real-time listener
db.collection("chats").doc(currentChatId)
  .collection("messages")
  .orderBy("time")
  .onSnapshot(snap => {
    document.getElementById("chatArea").innerHTML = "";
    snap.forEach(doc => addMessageToDOM(doc.data()));
  });

// Send message
document.getElementById("sendBtn").addEventListener("click", async () => {
  const text = document.getElementById("messageInput").value.trim();
  if (!text || !currentUser) return;

  await db.collection("chats")
    .doc(currentChatId)
    .collection("messages")
    .add({
      text,
      username: "anon",
      senderId: currentUser.uid,
      time: firebase.firestore.FieldValue.serverTimestamp()
    });

  document.getElementById("messageInput").value = "";
});
</script>

</body>
</html>
