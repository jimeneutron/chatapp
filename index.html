<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Chat App</title>

<style>
  body {
    margin: 0;
    font-family: sans-serif;
    height: 100vh;
    display: flex;
    flex-direction: column;
    background: #f0f0f0;
  }

  /* Top bar */
  #topBar {
    background: #1976d2;
    color: white;
    padding: 6px 10px;
    font-size: 18px;
    flex-shrink: 0;
  }

  /* Chat area */
  #chatArea {
    flex: 1;
    overflow-y: auto;
    padding: 8px;
    background: white;
  }

  .msg {
    margin-bottom: 10px;
    padding: 6px 10px;
    background: #e7f1ff;
    border-radius: 6px;
  }

  .meta {
    font-size: 12px;
    color: #444;
  }

  /* Message bar */
  #inputBar {
    display: flex;
    padding: 6px;
    border-top: 1px solid #ccc;
    background: #fafafa;
    flex-shrink: 0;
  }

  #messageInput {
    flex: 1;
    padding: 8px;
    font-size: 16px;
  }

  #sendBtn {
    padding: 8px 14px;
    margin-left: 6px;
    font-size: 16px;
    background: #1976d2;
    color: white;
    border: none;
    border-radius: 4px;
  }
</style>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

<script>
  // your firebase config
  const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_AUTH_DOMAIN",
    projectId: "YOUR_PROJECT_ID",
    storageBucket: "YOUR_STORAGE_BUCKET",
    messagingSenderId: "YOUR_SENDER_ID",
    appId: "YOUR_APP_ID"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();
</script>

</head>
<body>

<div id="topBar">Chat</div>

<div id="chatArea"></div>

<div id="inputBar">
  <input id="messageInput" placeholder="Message…" />
  <button id="sendBtn">Send</button>
</div>


<script>
let currentUser = null;
let currentChatId = "global";

// Sign in anonymously
firebase.auth().signInAnonymously().then(u => {
  currentUser = u.user;
});

// Format timestamp with date + time
function formatTime(d){
  const year = d.getFullYear();
  const month = (d.getMonth() + 1).toString().padStart(2, '0');
  const day = d.getDate().toString().padStart(2, '0');
  const h = d.getHours().toString().padStart(2,'0');
  const m = d.getMinutes().toString().padStart(2,'0');
  const s = d.getSeconds().toString().padStart(2,'0');
  return `${year}-${month}-${day} ${h}:${m}:${s}`;
}

// Add message to DOM
function addMessageToDOM(msgData) {
  const msgDiv = document.createElement("div");
  msgDiv.className = "msg";

  msgDiv.innerHTML = `
    <div>${msgData.text}</div>
    <div class="meta">
      ${msgData.username || "anon"} –
      ${formatTime(msgData.time?.toDate?.() || new Date())}
    </div>
  `;

  document.getElementById("chatArea").appendChild(msgDiv);
  document.getElementById("chatArea").scrollTop =
    document.getElementById("chatArea").scrollHeight;
}

// Real-time listener
db.collection("chats").doc(currentChatId)
  .collection("messages")
  .orderBy("time")
  .onSnapshot(snap => {
    document.getElementById("chatArea").innerHTML = "";
    snap.forEach(doc => addMessageToDOM(doc.data()));
  });

// Send message
document.getElementById("sendBtn").addEventListener("click", async () => {
  const text = document.getElementById("messageInput").value.trim();
  if (!text || !currentUser) return;

  await db.collection("chats")
    .doc(currentChatId)
    .collection("messages")
    .add({
      text,
      username: "anon",
      senderId: currentUser.uid,
      time: firebase.firestore.FieldValue.serverTimestamp()
    });

  document.getElementById("messageInput").value = "";
});
</script>

</body>
</html>
